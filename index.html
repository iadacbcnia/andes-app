<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andes - Tu Gu√≠a en la Comarca Andina</title>
    <script src="https://cdn.tailwindcss.com?v=2"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css?v=2" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js?v=2" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- AFRAME ya no se usa, pero lo dejamos por si acaso (opcional) -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js?v=2"></script>
    <style>
        :root {
            --emerald-500: #10b981;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            --slate-700: #334155;
            --gray-100: #f3f4f6;
            --white: #ffffff;
        }
        .dark {
            --bg-color: var(--slate-800);
            --text-color: var(--gray-100);
            --card-bg: var(--slate-700);
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1e293b; /* slate-800 */
            color: #f3f4f6; /* gray-100 */
            margin: 0;
        }
        .mic-input-btn svg {
            color: #94a3b8 !important;
        }
        /* ‚úÖ Correcci√≥n para el modal de gesti√≥n de contenido */
        #manage-list .bg-gray-100,
        #manage-list .bg-white,
        #manage-list .bg-gray-50 {
            background-color: #334155 !important;
            color: #f3f4f6 !important;
        }
        #manage-list .border-gray-200 {
            border-color: #475569 !important;
        }
        #manage-list .text-gray-600,
        #manage-list .text-gray-700,
        #manage-list .text-gray-800,
        #manage-list .text-gray-900 {
            color: #cbd5e1 !important;
        }
        #manage-list .hover\:bg-gray-200:hover {
            background-color: #475569 !important;
        }
        #manage-list .hover\:text-gray-700:hover {
            color: #f3f4f6 !important;
        }
        .sponsored-message {
            background-color: var(--card-bg, var(--white));
            border: 2px solid #facc15;
            box-shadow: 0 4px 14px 0 rgba(250, 204, 21, 0.3);
        }
        .place-link {
            color: var(--emerald-500);
            font-weight: 500;
            cursor: pointer;
        }
        .place-link:hover {
            text-decoration: underline;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #9ca3af;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-of-type(2) {
            animation-delay: -0.32s;
        }
        .typing-indicator span:nth-of-type(3) {
            animation-delay: -0.64s;
        }
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        input, textarea, select {
            background-color: #334155 !important;
            color: #f3f4f6 !important;
            border-color: #475569 !important;
        }
        input::placeholder, textarea::placeholder {
            color: #94a3b8 !important;
        }
        .planner-option-btn.active,
        .planner-option-btn:hover {
            background-color: #10b981 !important;
            border-color: #10b981 !important;
            color: white !important;
        }
        .planner-option-btn svg {
            width: 2rem;
            height: 2rem;
            margin-bottom: 0.5rem;
            fill: currentColor;
        }
        .planner-option-btn span {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        .bottom-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .bottom-nav-btn.active,
        .bottom-nav-btn:hover {
            color: #10b981; /* emerald-500 */
            background-color: #334155; /* slate-700 */
            border-radius: 0.25rem;
            transform: scale(1.05);
        }
        .bottom-nav-btn svg {
            width: 1.5rem;
            height: 1.5rem;
            margin-bottom: 0.25rem;
            fill: currentColor;
        }
        @media (max-width: 768px) {
            .bottom-nav-btn {
                font-size: 0.65rem;
                padding: 0.15rem;
            }
            .bottom-nav-btn span {
                font-size: 0.75rem;
            }
        }
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            background-color: #1e293b; /* slate-800 */
        }
        .input-container {
            padding: 1rem;
            background-color: #1e293b; /* slate-800 */
            border-top: 1px solid #334155; /* slate-700 */
        }
        .radio-player-container {
            padding: 0.5rem 1rem;
            background-color: var(--card-bg, var(--white));
            border-top: 1px solid var(--slate-700);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .radio-logo-container {
            position: relative;
            width: 2.5rem;
            height: 2.5rem;
            background-color: black;
            border-radius: 50%;
        }
        .radio-logo {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            opacity: 0.7;
        }
        .radio-icon-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- Pantalla de Bienvenida -->
    <div id="welcome-screen" class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-emerald-50 to-white dark:from-slate-900 dark:to-slate-800 p-4">
        <div class="max-w-sm w-full flex flex-col items-center justify-center" style="max-height: calc(100dvh - env(safe-area-inset-top, 10px) - env(safe-area-inset-bottom, 80px)); overflow-y: auto; padding-bottom: env(safe-area-inset-bottom, 80px); padding-top: env(safe-area-inset-top, 10px);">
            <img src="https://i.postimg.cc/4d45rq7k/Chat-GPT-Image-28-sept-2025-19-09-13.png" alt="Andes, el Pudu Pudu gu√≠a" class="w-full rounded-xl shadow-lg mb-3">
            <h1 class="text-xl md:text-2xl font-bold mb-3 text-center">¬°Bienvenido, soy Andes!</h1>
            <p class="text-sm mb-4 text-center">Tu gu√≠a personal en la Comarca Andina.</p>
            <div class="space-y-2 mb-6">
                <div class="flex items-center justify-center gap-2">
                    <span class="bg-white text-emerald-600 px-2 py-0.5 rounded-full text-xs font-bold">‚ú®</span>
                    <span>Preg√∫ntame por lugares o planes</span>
                </div>
                <div class="flex items-center justify-center gap-2">
                    <span class="bg-white text-emerald-600 px-2 py-0.5 rounded-full text-xs font-bold">üó∫Ô∏è</span>
                    <span>Explora el mapa interactivo</span>
                </div>
                <div class="flex items-center justify-center gap-2">
                    <span class="bg-white text-emerald-600 px-2 py-0.5 rounded-full text-xs font-bold">üåßÔ∏è</span>
                    <span>Consulta el clima en tiempo real</span>
                </div>
            </div>
            <button id="start-chat-btn" class="w-full max-w-xs bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition transform hover:scale-105">
                ¬°Comenzar!
            </button>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div id="main-app" class="hidden flex flex-col h-screen max-w-4xl mx-auto">
        <div class="chat-container" id="chat-window">
            <div class="ai-message w-fit max-w-xs md:max-w-md lg:max-w-2xl p-3 rounded-2xl shadow">
                ¬°Hola! Soy Andes, tu gu√≠a personal en la Comarca Andina. Estoy aqu√≠ para ayudarte a descubrir los mejores lugares, planificar tu d√≠a o simplemente contarte sobre el clima. ¬øEn qu√© puedo ayudarte hoy?
            </div>
        </div>
        <div class="input-container">
            <div id="suggestions" class="flex flex-wrap gap-2 mb-2"></div>
            <form id="chat-form" class="flex items-center gap-2">
                <div class="relative w-full">
                    <input type="text" id="chat-input" class="w-full p-3 pr-12 border-2 border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-lg shadow-sm text-base focus:border-emerald-500 focus:ring-emerald-500 focus:outline-none" placeholder="Preg√∫ntame algo..." disabled>
                    <button type="button" id="mic-btn" class="absolute inset-y-0 right-0 flex items-center pr-3 mic-input-btn text-gray-500 hover:text-emerald-500">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>
                <button type="submit" class="bg-emerald-500 hover:bg-emerald-600 text-white p-3 rounded-lg shadow-md disabled:opacity-50" disabled>
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                    </svg>
                </button>
            </form>
        </div>
        <div class="radio-player-container hidden" id="radio-player-container">
            <div class="radio-logo-container">
                <img src="https://i.postimg.cc/4d45rq7k/Chat-GPT-Image-28-sept-2025-19-09-13.png" alt="Radio Andes" class="radio-logo">
                <div class="radio-icon-overlay" id="radio-icon-overlay">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>
                </div>
            </div>
            <span class="text-sm font-medium">Radio Andes Comarca</span>
        </div>
        <div class="fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-700 z-40">
            <div class="flex justify-around">
                <button id="rincon-btn" class="bottom-nav-btn">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zM6 8a2 2 0 11-4 0 2 2 0 014 0zM1.49 15.326a.78.78 0 01-.358-.442 3 3 0 014.308-3.516 6.484 6.484 0 00-1.905 3.959c-.023.222-.014.442.028.658a.78.78 0 01-.357.443 3.377 3.377 0 01-2.924.001zM18 8a2 2 0 11-4 0 2 2 0 014 0zm-1.808 1.054a6.458 6.458 0 00-1.905-3.959 3 3 0 014.308 3.516.78.78 0 01-.357-.443c.042-.216.051-.436.028-.658a.78.78 0 01-.358.442 3.377 3.377 0 01-2.924-.001zM10 18a3 3 0 100-6 3 3 0 000 6z" />
                    </svg>
                    <span>Rinc√≥n</span>
                </button>
                <button id="map-btn" class="bottom-nav-btn">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.1.4-.223.654-.369.26-.15.552-.333.865-.55C12.864 17.113 14 15.823 14 14c0-2.21-1.79-4-4-4S6 11.79 6 14c0 1.823 1.136 3.113 1.966 3.868.313.217.605.4.865.55.254.146.468.269.654.369a5.741 5.741 0 00.28.14l.018.008.006.003zM10 11.25a2.75 2.75 0 100 5.5 2.75 2.75 0 000-5.5z" clip-rule="evenodd" />
                        <path d="M10 2C4.477 2 0 6.477 0 12s4.477 10 10 10 10-4.477 10-10S15.523 2 10 2zM8 14a2 2 0 114 0 2 2 0 01-4 0z" />
                    </svg>
                    <span>Mapa</span>
                </button>
                <button id="admin-btn" class="bottom-nav-btn">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.5 4A1.5 1.5 0 001 5.5v9A1.5 1.5 0 002.5 16h15a1.5 1.5 0 001.5-1.5v-9A1.5 1.5 0 0017.5 4h-15zM2 5.5a.5.5 0 01.5-.5h15a.5.5 0 01.5.5v9a.5.5 0 01-.5.5h-15a.5.5 0 01-.5-.5v-9zM8 8a.75.75 0 000 1.5h4a.75.75 0 000-1.5H8z" clip-rule="evenodd" />
                    </svg>
                    <span>Gestionar Contenido</span>
                </button>
                <button id="planner-btn" class="bottom-nav-btn">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.5-13.5-3.432 3.432-3.432-3.432s.5-1.5 1.5-1.5 2.432 1.5 3.432 1.5 1.932-1.5 1.932-1.5ZM8.25 18.75h7.5" />
                    </svg>
                    <span>Planificador</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Contribuci√≥n -->
    <div id="contribution-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[65] transition-opacity duration-300">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-slate-800 text-gray-100 max-h-[85vh] flex flex-col">
            <div class="mt-3 text-center">
                <h3 id="contribution-title" class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">A√±adir conocimiento a Andes</h3>
                <div class="mt-2 flex-grow overflow-y-auto p-2">
                    <div id="contribution-tabs" class="border-b border-gray-200 dark:border-slate-600">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <button id="tab-single" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-emerald-500 border-emerald-500">A√±adir Uno</button>
                            <button id="tab-bulk" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200">Carga R√°pida</button>
                        </nav>
                    </div>
                    <form id="contribution-form" class="mt-4 space-y-4 text-left">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="lugar-tipo" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tipo de Lugar</label>
                                <select id="lugar-tipo" required class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                                    <option value="restaurantes" data-subtype="Restaurante">Restaurante</option>
                                    <option value="restaurantes" data-subtype="Bar">Bar</option>
                                    <option value="restaurantes" data-subtype="Confiter√≠a">Confiter√≠a</option>
                                    <option value="restaurantes" data-subtype="Casa de T√©">Casa de T√©</option>
                                    <option value="alojamiento" data-subtype="Apart Hotel">Apart Hotel</option>
                                    <option value="alojamiento" data-subtype="Caba√±as">Caba√±as</option>
                                    <option value="alojamiento" data-subtype="Hotel">Hotel</option>
                                    <option value="alojamiento" data-subtype="Hostel">Hostel</option>
                                    <option value="alojamiento" data-subtype="Bread & Breakfast">Bread & Breakfast</option>
                                    <option value="actividades">Actividades</option>
                                    <option value="lugaresParaVisitar">Lugar para Visitar</option>
                                </select>
                            </div>
                            <div>
                                <label for="lugar-localidad" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Localidad</label>
                                <select id="lugar-localidad" required class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                                    <option>El Bols√≥n</option>
                                    <option>Lago Puelo</option>
                                    <option>El Hoyo</option>
                                    <option>Epuy√©n</option>
                                    <option>El Mait√©n</option>
                                    <option>Cholila</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="lugar-nombre" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nombre del Lugar</label>
                            <div class="relative w-full mt-1">
                                <input type="text" id="lugar-nombre" required class="block w-full p-2 pr-10 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 mic-input-btn text-gray-500 hover:text-emerald-500">
                                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"/><path d="M5.5 9.5a.5.5 0 01.5.5v1a4 4 0 004 4h.5a.5.5 0 010 1h-.5a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"/><path d="M10 15a1 1 0 001-1v-1a1 1 0 10-2 0v1a1 1 0 001 1z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label for="lugar-direccion" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Direcci√≥n (Opcional)</label>
                            <div class="relative w-full mt-1">
                                <input type="text" id="lugar-direccion" class="block w-full p-2 pr-10 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 mic-input-btn text-gray-500 hover:text-emerald-500">
                                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"/><path d="M5.5 9.5a.5.5 0 01.5.5v1a4 4 0 004 4h.5a.5.5 0 010 1h-.5a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"/><path d="M10 15a1 1 0 001-1v-1a1 1 0 10-2 0v1a1 1 0 001 1z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label for="lugar-telefono" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tel√©fono (Opcional)</label>
                            <div class="relative w-full mt-1">
                                <input type="text" id="lugar-telefono" class="block w-full p-2 pr-10 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 mic-input-btn text-gray-500 hover:text-emerald-500">
                                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"/><path d="M5.5 9.5a.5.5 0 01.5.5v1a4 4 0 004 4h.5a.5.5 0 010 1h-.5a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"/><path d="M10 15a1 1 0 001-1v-1a1 1 0 10-2 0v1a1 1 0 001 1z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="lugar-latitud" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Latitud (Opcional)</label>
                                <input type="text" id="lugar-latitud" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="-41.9669">
                            </div>
                            <div>
                                <label for="lugar-longitud" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Longitud (Opcional)</label>
                                <input type="text" id="lugar-longitud" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="-71.5333">
                            </div>
                        </div>
                        <div>
                            <label for="lugar-imagen" class="block text-sm font-medium text-gray-700 dark:text-gray-300">URL de Imagen Principal</label>
                            <input type="url" id="lugar-imagen" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="https://ejemplo.com/foto.jpg">
                        </div>
                        <!-- ‚úÖ NUEVO: Selector de nivel de auspicio -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nivel de auspicio</label>
                            <select id="lugar-nivel-auspicio" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                                <option value="0">Ninguno</option>
                                <option value="1">Bronce (1 estrella)</option>
                                <option value="2">Plata (2 estrellas)</option>
                                <option value="3">Oro (3 estrellas)</option>
                            </select>
                        </div>
                        <!-- ‚úÖ NUEVO: Campos de fotos adicionales -->
                        <div id="campos-fotos-auspicio" class="hidden space-y-3">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Fotos adicionales (m√°x. 4)</label>
                            <input type="url" id="lugar-imagen2" class="block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="URL de la foto 2">
                            <input type="url" id="lugar-imagen3" class="block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="URL de la foto 3">
                            <input type="url" id="lugar-imagen4" class="block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="URL de la foto 4">
                            <input type="url" id="lugar-imagen5" class="block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="URL de la foto 5">
                        </div>
                        <div>
                            <label for="lugar-imagen360" class="block text-sm font-medium text-gray-700 dark:text-gray-300">URL de Imagen 360¬∞ (Opcional)</label>
                            <input type="url" id="lugar-imagen360" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="https://ejemplo.com/foto_360.jpg">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Pega aqu√≠ el link a una foto equirectangular (formato 360¬∞).</p>
                        </div>
                        <div>
                            <label for="lugar-descripcion" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Descripci√≥n</label>
                            <textarea id="lugar-descripcion" rows="4" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="Describe el lugar, servicios, ambiente, etc."></textarea>
                        </div>
                        <div class="pt-4 flex justify-end">
                            <button type="submit" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-md">A√±adir Lugar</button>
                        </div>
                    </form>
                    <!-- Formulario de carga r√°pida -->
                    <div id="bulk-entry-form-container" class="hidden mt-4 space-y-4">
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Pega cada lugar en una nueva l√≠nea. Separa cada dato con una coma. <strong class="dark:text-gray-200">La descripci√≥n siempre debe ir al final.</strong></p>
                        <p class="text-xs text-gray-500 dark:text-gray-300 mb-2">Si no tienes un dato (ej: tel√©fono o coordenadas), deja el espacio vac√≠o entre las comas.</p>
                        <p class="text-xs text-gray-500 dark:text-gray-300 bg-gray-100 dark:bg-slate-700 p-2 rounded-md mb-4"><code>Tipo: Caba√±as, Nombre: Mi Caba√±a, Localidad: El Bols√≥n, ... , Descripci√≥n completa...: Texto libre.</code></p>
                        <div class="relative w-full mt-1">
                            <textarea id="bulk-input" rows="8" class="block w-full p-2 pr-10 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md" placeholder="Tipo: Caba√±as, Nombre: Caba√±a La Escondida, Localidad: El Hoyo, Direcci√≥n: Curva de fin de la recta de El Pedregoso, Tel√©fono: +54 (294) 459-7157, Latitud: -42.007621, Longitud: -71.522818, Descripci√≥n completa...: Caba√±a con capacidad para 4 personas, ideal para el descanso"></textarea>
                            <button type="button" class="absolute top-0 right-0 flex items-center pt-3 pr-3 mic-input-btn text-gray-500 hover:text-emerald-500">
                                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"/><path d="M5.5 9.5a.5.5 0 01.5.5v1a4 4 0 004 4h.5a.5.5 0 010 1h-.5a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"/><path d="M10 15a1 1 0 001-1v-1a1 1 0 10-2 0v1a1 1 0 001 1z"/>
                                </svg>
                            </button>
                        </div>
                        <button type="button" id="process-bulk-btn" class="bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-600">Procesar</button>
                        <div id="bulk-review-container" class="mt-4"></div>
                    </div>
                </div>
            </div>
            <div class="items-center px-4 py-3">
                <button id="close-contribution-modal-btn" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-600">Cerrar</button>
            </div>
        </div>
    </div>
                        <div>
                            <label for="lugar-datos-clave" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Datos Clave (Opcional)</label>
                            <textarea id="lugar-datos-clave" rows="3" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm" placeholder="Ej: Horario: 9 a 18hs. No se aceptan mascotas."></textarea>
                        </div>
                        <div class="pt-4 flex justify-end">
                            <button type="submit" id="contribution-submit-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-md">A√±adir Lugar</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="items-center px-4 py-3">
                <button id="close-contribution-modal-btn" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-600">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Gesti√≥n -->
    <div id="manage-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[60] transition-opacity duration-300">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-slate-800 text-gray-100 max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-2 border-b dark:border-slate-600">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Gestionar Contenido</h3>
                <div class="flex items-center gap-2">
                    <button id="download-backup-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 text-sm flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Descargar Backup
                    </button>
                    <button id="restore-backup-btn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 text-sm flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                        Restaurar Backup
                    </button>
                    <input type="file" id="backup-file-input" accept=".csv" class="hidden">
                    <button id="toggle-dark-mode-btn" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 text-sm flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                        </svg>
                        Modo Oscuro
                    </button>
                </div>
            </div>
            <div id="manage-list" class="flex-grow overflow-y-auto pr-2"></div>
            <div class="items-center px-4 py-3 text-right mt-4 border-t dark:border-slate-600">
                <button id="close-manage-modal-btn" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-600">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Eliminaci√≥n -->
    <div id="confirm-delete-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[65] transition-opacity duration-300">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-slate-800">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Confirmar Eliminaci√≥n</h3>
                <p id="delete-confirmation-text" class="mt-2 text-sm text-gray-600 dark:text-gray-300"></p>
                <div class="mt-4 flex justify-end space-x-2">
                    <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400">Cancelar</button>
                    <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">S√≠, eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Eliminaci√≥n de Rubro -->
    <div id="confirm-rubro-delete-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[65] transition-opacity duration-300">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-slate-800">
            <div class="mt-3 text-center">
                <h3 class="text-lg font-medium text-red-600 dark:text-red-400">¬°Acci√≥n Irreversible!</h3>
                <p id="rubro-delete-confirmation-text" class="mt-2 text-sm text-gray-600 dark:text-gray-300"></p>
                <div class="mt-4 flex justify-end space-x-2">
                    <button id="cancel-rubro-delete-btn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400">Cancelar</button>
                    <button id="confirm-rubro-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">S√≠, eliminar rubro</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal del Rinc√≥n del Viajero -->
    <div id="rincon-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 transition-opacity duration-300">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-slate-800 text-gray-100 max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-2 border-b dark:border-slate-600">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">El Rinc√≥n del Viajero</h3>
                <button id="close-rincon-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <form id="tip-form" class="mb-4">
                <label for="tip-input" class="sr-only">Deja tu consejo</label>
                <textarea id="tip-input" rows="3" class="w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-md" placeholder="Comparte un dato, una recomendaci√≥n o un consejo para otros viajeros..."></textarea>
                <div class="text-right mt-2">
                    <button type="submit" class="bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-600">Compartir Consejo</button>
                </div>
            </form>
            <div id="rincon-list" class="flex-grow overflow-y-auto pr-2 space-y-4"></div>
        </div>
    </div>

    <!-- Modal de Valoraciones -->
    <div id="rating-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[70] transition-opacity duration-300">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-slate-800 text-gray-100 max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-2 border-b dark:border-slate-600">
                <h3 id="rating-modal-title" class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Opiniones y Valoraciones</h3>
                <button id="close-rating-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <div id="average-rating-container" class="mb-4"></div>
            <div id="comments-list" class="space-y-4"></div>
            <form id="rating-form" class="mt-4 border-t dark:border-slate-600 pt-4">
                <h4 class="text-md font-semibold mb-2 text-gray-800 dark:text-gray-200">Deja tu valoraci√≥n</h4>
                <div class="star-rating mb-2">
                    <input type="radio" id="5-stars" name="rating" value="5" /><label for="5-stars">‚òÖ</label>
                    <input type="radio" id="4-stars" name="rating" value="4" /><label for="4-stars">‚òÖ</label>
                    <input type="radio" id="3-stars" name="rating" value="3" /><label for="3-stars">‚òÖ</label>
                    <input type="radio" id="2-stars" name="rating" value="2" /><label for="2-stars">‚òÖ</label>
                    <input type="radio" id="1-star" name="rating" value="1" /><label for="1-star">‚òÖ</label>
                </div>
                <textarea id="comment-input" rows="3" class="w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-md" placeholder="Escribe tu comentario aqu√≠..."></textarea>
                <div class="text-right mt-2">
                    <button type="submit" class="bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-600">Enviar Opini√≥n</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal del Mapa -->
    <div id="map-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 h-full w-full hidden z-[80] transition-opacity duration-300 flex flex-col">
        <div class="p-4 bg-slate-800 text-white flex justify-between items-center">
            <h2 class="text-xl font-bold">Mapa Interactivo</h2>
            <button id="close-map-modal-btn" class="p-2 rounded-full bg-black bg-opacity-50 hover:bg-opacity-75">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <div id="map-container" class="flex-grow w-full h-full"></div>
    </div>

    <!-- Modal de VR (360¬∞) -->
    <div id="vr-modal" class="fixed inset-0 bg-black bg-opacity-90 h-full w-full hidden z-[85] transition-opacity duration-300 flex flex-col items-center justify-center">
        <button id="close-vr-modal-btn" class="absolute top-4 right-4 p-2 rounded-full bg-black bg-opacity-50 hover:bg-opacity-75">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
        </button>
        <a-scene id="vr-scene" embedded>
            <a-sky id="vr-sky" radius="100"></a-sky>
        </a-scene>
    </div>

    <!-- Modal de Planificador -->
    <div id="planner-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[55] transition-opacity duration-300">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-slate-800 text-gray-100 max-h-[85vh] flex flex-col">
            <div class="mt-3 text-center">
                <div class="flex justify-center mb-4">
                    <svg class="h-10 w-10 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.5-13.5-3.432 3.432-3.432-3.432s.5-1.5 1.5-1.5 2.432 1.5 3.432 1.5 1.932-1.5 1.932-1.5ZM8.25 18.75h7.5" />
                    </svg>
                </div>
                <h3 class="text-2xl leading-6 font-bold text-gray-900 dark:text-gray-100">Crea tu Aventura Perfecta</h3>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Solo necesitamos 4 datos para dise√±arte un plan a medida.</p>
            </div>
            <form id="planner-form" class="mt-4 space-y-6 text-left">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Estilo de Viaje</label>
                    <div id="planner-style-group" class="grid grid-cols-2 gap-3">
                        <button type="button" data-value="Aventura" class="planner-option-btn bg-emerald-500 text-white border-emerald-500">
                            <span>‚õ∞Ô∏è</span>
                            <span>Aventura</span>
                        </button>
                        <button type="button" data-value="Relax" class="planner-option-btn">
                            <span>üßò</span>
                            <span>Relax</span>
                        </button>
                        <button type="button" data-value="Familia" class="planner-option-btn">
                            <span>üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                            <span>Familia</span>
                        </button>
                        <button type="button" data-value="Rom√°ntico" class="planner-option-btn">
                            <span>‚ù§Ô∏è</span>
                            <span>Rom√°ntico</span>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nivel de Energ√≠a</label>
                    <div id="planner-energy-group" class="grid grid-cols-3 gap-3">
                        <button type="button" data-value="Bajo" class="planner-option-btn">
                            <span>üò¥</span>
                            <span>Bajo</span>
                        </button>
                        <button type="button" data-value="Medio" class="planner-option-btn bg-emerald-500 text-white border-emerald-500">
                            <span>üôÇ</span>
                            <span>Medio</span>
                        </button>
                        <button type="button" data-value="Alto" class="planner-option-btn">
                            <span>üí™</span>
                            <span>Alto</span>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cantidad de D√≠as</label>
                    <select id="planner-days" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-md shadow-sm">
                        <option value="1">1 d√≠a</option>
                        <option value="2">2 d√≠as</option>
                        <option value="3">3 d√≠as</option>
                        <option value="4">4 d√≠as</option>
                        <option value="5">5 d√≠as</option>
                        <option value="6">6 d√≠as</option>
                        <option value="7">7 d√≠as</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Localidades a Incluir</label>
                    <div id="planner-localidades-group" class="grid grid-cols-2 sm:grid-cols-3 gap-3 mt-2">
                        <label class="flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 border-gray-200 dark:border-slate-600">
                            <input type="checkbox" name="localidad" value="El Bols√≥n" class="planner-localidad-checkbox h-5 w-5 text-emerald-500 rounded" checked>
                            <span>El Bols√≥n</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 border-gray-200 dark:border-slate-600">
                            <input type="checkbox" name="localidad" value="Lago Puelo" class="planner-localidad-checkbox h-5 w-5 text-emerald-500 rounded">
                            <span>Lago Puelo</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 border-gray-200 dark:border-slate-600">
                            <input type="checkbox" name="localidad" value="El Hoyo" class="planner-localidad-checkbox h-5 w-5 text-emerald-500 rounded">
                            <span>El Hoyo</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 border-gray-200 dark:border-slate-600">
                            <input type="checkbox" name="localidad" value="Epuy√©n" class="planner-localidad-checkbox h-5 w-5 text-emerald-500 rounded">
                            <span>Epuy√©n</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 border-gray-200 dark:border-slate-600">
                            <input type="checkbox" name="localidad" value="El Mait√©n" class="planner-localidad-checkbox h-5 w-5 text-emerald-500 rounded">
                            <span>El Mait√©n</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer bg-gray-50 dark:bg-slate-700 border-gray-200 dark:border-slate-600">
                            <input type="checkbox" name="localidad" value="Cholila" class="planner-localidad-checkbox h-5 w-5 text-emerald-500 rounded">
                            <span>Cholila</span>
                        </label>
                    </div>
                </div>
                <div class="pt-4 flex justify-end">
                    <button type="submit" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-md">Generar Plan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Contrase√±a de Admin -->
    <div id="password-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-40 transition-opacity duration-300">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-slate-800">
            <div class="flex justify-between items-center pb-3 border-b dark:border-slate-600">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Acceso de Administrador</h3>
                <button id="close-password-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <form id="password-form" class="mt-4">
                <label for="password-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Contrase√±a</label>
                <input type="password" id="password-input" class="mt-1 block w-full p-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm">
                <p id="password-error" class="text-red-500 text-xs mt-1 hidden">Contrase√±a incorrecta.</p>
                <div class="flex justify-end space-x-2 mt-4">
                    <button type="button" id="close-password-modal-btn-2" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-emerald-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-emerald-600">Entrar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Panel de Admin -->
    <div id="admin-panel-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 transition-opacity duration-300">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-slate-800">
            <div class="flex justify-between items-center pb-3 border-b dark:border-slate-600">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Panel de Administraci√≥n</h3>
                <button id="close-admin-panel-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <div class="mt-4 space-y-3">
                <p class="text-sm text-gray-600 dark:text-gray-300">Desde aqu√≠ puedes a√±adir nuevo contenido y gestionar la informaci√≥n existente.</p>
                <button id="admin-add-btn" class="w-full flex items-center justify-center text-left p-3 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white font-medium">
                    <svg class="h-6 w-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>
                    A√±adir Nuevo Lugar
                </button>
                <button id="admin-manage-btn" class="w-full flex items-center justify-center text-left p-3 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-medium">
                    <svg class="h-6 w-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.949a.75.75 0 00.95.544l4.25-1.214a.75.75 0 01.44 1.392l-4.25 1.214a.75.75 0 00-.95.544l-1.414 4.949a.75.75 0 00.826.95l14.083-4.024a.75.75 0 000-1.425L3.105 2.289z" />
                    </svg>
                    Gestionar Contenido
                </button>
            </div>
        </div>
    </div>

    <!-- Audio Player para Radio -->
    <audio id="radio-player" preload="none"></audio>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
            import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
            import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp, doc, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

            // === VARIABLES GLOBALES ===
            let db, auth, userId, lugaresCollectionRef, consejosCollectionRef;
            let dynamicKnowledgeBase = {};
            let placesCache = [];
            let tipsCache = [];
            let chatHistory = [];
            let isAdmin = false;
            let isDataReady = false;
            let map = null;
            let mapInitialized = false;
            let markersLayer = null;
            let markersById = {};
            let mainRecognition;
            let isMainMicListening = false;
            let activeSpeechInput = null;
            let currentPlaceIdForRating = null;
            let currentPlaceCommentsUnsubscribe = null;
            let highlightedMarkerLayer = null;
            let isDarkMode = true;

            // === REFERENCIAS A ELEMENTOS ===
            const welcomeScreen = document.getElementById('welcome-screen');
            const mainApp = document.getElementById('main-app');
            const chatWindow = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const submitButton = chatForm.querySelector('button[type="submit"]');
            const suggestionsContainer = document.getElementById('suggestions');
            const micBtn = document.getElementById('mic-btn');
            const contributionModal = document.getElementById('contribution-modal');
            const manageModal = document.getElementById('manage-modal');
            const rinconModal = document.getElementById('rincon-modal');
            const ratingModal = document.getElementById('rating-modal');
            const mapModal = document.getElementById('map-modal');
            const vrModal = document.getElementById('vr-modal');
            const passwordModal = document.getElementById('password-modal');
            const adminPanelModal = document.getElementById('admin-panel-modal');
            const plannerModal = document.getElementById('planner-modal');
            const confirmDeleteModal = document.getElementById('confirm-delete-modal');
            const confirmRubroDeleteModal = document.getElementById('confirm-rubro-delete-modal');
            const deleteConfirmationText = document.getElementById('delete-confirmation-text');
            const rubroDeleteConfirmationText = document.getElementById('rubro-delete-confirmation-text');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const cancelRubroDeleteBtn = document.getElementById('cancel-rubro-delete-btn');
            const confirmRubroDeleteBtn = document.getElementById('confirm-rubro-delete-btn');
            const ratingModalTitle = document.getElementById('rating-modal-title');
            const averageRatingContainer = document.getElementById('average-rating-container');
            const commentsList = document.getElementById('comments-list');
            const ratingForm = document.getElementById('rating-form');
            const commentInput = document.getElementById('comment-input');
            const rinconBtn = document.getElementById('rincon-btn');
            const mapBtn = document.getElementById('map-btn');
            const adminBtn = document.getElementById('admin-btn');
            const plannerBtn = document.getElementById('planner-btn');
            const closeContributionModalBtn = document.getElementById('close-contribution-modal-btn');
            const closeManageModalBtn = document.getElementById('close-manage-modal-btn');
            const closeRinconModalBtn = document.getElementById('close-rincon-modal-btn');
            const closeRatingModalBtn = document.getElementById('close-rating-modal-btn');
            const closeMapModalBtn = document.getElementById('close-map-modal-btn');
            const closeVrModalBtn = document.getElementById('close-vr-modal-btn');
            const closePasswordModalBtn = document.getElementById('close-password-modal-btn');
            const closeAdminPanelBtn = document.getElementById('close-admin-panel-btn');
            const closePlannerModalBtn = document.getElementById('close-planner-modal-btn');
            const passwordForm = document.getElementById('password-form');
            const passwordInput = document.getElementById('password-input');
            const passwordError = document.getElementById('password-error');
            const downloadBackupBtn = document.getElementById('download-backup-btn');
            const restoreBackupBtn = document.getElementById('restore-backup-btn');
            const backupFileInput = document.getElementById('backup-file-input');
            const toggleDarkModeBtn = document.getElementById('toggle-dark-mode-btn');
            const contributionForm = document.getElementById('contribution-form');
            const tipForm = document.getElementById('tip-form');
            const tipInput = document.getElementById('tip-input');
            const plannerForm = document.getElementById('planner-form');

            // === INICIALIZAR APP ===
            function startApp() {
                if (welcomeScreen) welcomeScreen.classList.add('hidden');
                if (mainApp) mainApp.classList.remove('hidden');
                setTimeout(() => {
                    if (chatInput) chatInput.disabled = false;
                    if (submitButton) submitButton.disabled = false;
                    if (chatInput) chatInput.placeholder = "Preg√∫ntame algo...";
                }, 300);
                initializeFirebase();
                updateSuggestions();
            }

            // === INICIALIZAR FIREBASE ===
            function initializeFirebase() {
                const firebaseConfig = {
                    apiKey: "AIzaSyB2Z9PnT0bz9SI47_BW1BcW1tjqbQjYnC0",
                    authDomain: "andes-app-turismo.firebaseapp.com",
                    projectId: "andes-app-turismo",
                    storageBucket: "andes-app-turismo.appspot.com",
                    messagingSenderId: "685878856963",
                    appId: "1:685878856963:web:660823dfdac24a0c39ed36"
                };
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        lugaresCollectionRef = collection(db, `/artifacts/default-app-id/public/data/lugares`);
                        consejosCollectionRef = collection(db, `/artifacts/default-app-id/public/data/consejos`);
                        listenForNewPlaces();
                        listenForTips();
                    } else {
                        await signInAnonymously(auth);
                    }
                });
            }

            // === CLIMA ===
            async function getWeatherData(location) {
                const coordinates = {
                    "el bols√≥n": { lat: -41.96, lon: -71.53 },
                    "lago puelo": { lat: -42.06, lon: -71.60 },
                    "el hoyo": { lat: -42.06, lon: -71.51 },
                    "epuy√©n": { lat: -42.23, lon: -71.35 },
                    "el mait√©n": { lat: -42.05, lon: -71.16 },
                    "cholila": { lat: -42.51, lon: -71.45 },
                    "san carlos de bariloche": { lat: -41.13, lon: -71.31 }
                };
                const loc = location.toLowerCase().trim();
                if (!coordinates[loc]) {
                    return { error: `Lo siento, no tengo datos del clima para "${location}".` };
                }
                const { lat, lon } = coordinates[loc];
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=America/Argentina/Buenos_Aires&forecast_days=7`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error("API no respondi√≥");
                    const data = await response.json();
                    return { data, location };
                } catch (error) {
                    return { error: "Tuve un problema para conectarme con el servicio del clima." };
                }
            }

            const weatherCodeToDescription = {
                0: "Cielo despejado", 1: "Mayormente despejado", 2: "Parcialmente nublado", 3: "Nublado",
                45: "Niebla", 48: "Niebla con escarcha", 51: "Llovizna ligera", 53: "Llovizna", 55: "Llovizna intensa",
                61: "Lluvia ligera", 63: "Lluvia", 65: "Lluvia intensa", 71: "Nevada ligera", 73: "Nevada", 75: "Nevada intensa",
                95: "Tormenta", 96: "Tormenta con granizo ligero", 99: "Tormenta con granizo intenso"
            };

            async function formatWeatherResponse(weatherInfo, timeframe) {
                const current = weatherInfo.data.current;
                const daily = weatherInfo.data.daily;
                const lugar = weatherInfo.location;
                const now = new Date();
                const isNight = now.getHours() >= 21;
                const hoy = now.toLocaleDateString('es-AR', { weekday: 'long' });
                const tempActual = Math.round(current.temperature_2m);
                const climaActualDesc = weatherCodeToDescription[current.weather_code] || "Clima actual";
                const resumenSemanal = [];
                const startIndex = isNight ? 1 : 0;
                for (let i = startIndex; i < Math.min(startIndex + 7, daily.time.length); i++) {
                    const fecha = new Date(daily.time[i]);
                    let dia;
                    if (i === 0) dia = hoy;
                    else if (i === 1 && isNight) dia = "Ma√±ana";
                    else dia = fecha.toLocaleDateString('es-AR', { weekday: 'long' });
                    resumenSemanal.push({
                        dia: dia,
                        temp_max: Math.round(daily.temperature_2m_max[i]),
                        temp_min: Math.round(daily.temperature_2m_min[i]),
                        descripcion: weatherCodeToDescription[daily.weather_code[i]] || "Clima"
                    });
                }
                const relevantData = {
                    lugar: lugar,
                    clima_actual: { temperatura: tempActual, descripcion: climaActualDesc, es_noche: isNight },
                    pronostico_semanal: resumenSemanal
                };
                const prompt = `
                    Eres Andes, un gu√≠a tur√≠stico amigable y profesional de la Comarca Andina, en la Patagonia Argentina.
                    IMPORTANTE: En la Patagonia, **nadie usa paraguas** por el viento fuerte. Si hay lluvia, siempre se recomienda un **impermeable, chubasquero o ropa impermeable**, nunca un paraguas.
                    Evita ser demasiado informal. S√© cercano, pero profesional.
                    Si "es_noche" es true, no hables de "hoy" como si a√∫n hubiera actividades diurnas.
                    Datos del clima:
                    ${JSON.stringify(relevantData)}
                `;
                const history = [{ role: "user", parts: [{ text: "Dame el clima" }] }];
                const response = await getAIResponse(history, prompt);
                return response.text;
            }

            async function getAIResponse(history, systemInstructions) {
                const TIMEOUT_MS = 15000;
                try {
                    const apiKey = "AIzaSyCH9o4_vc4ih8G95AEXGnk7fF3ZnP1aYas";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_MS);
                    const payload = {
                        contents: history,
                        systemInstruction: { parts: [{ text: systemInstructions }] }
                    };
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    if (!response.ok) throw new Error(`API fall√≥: ${response.status}`);
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Lo siento, no pude generar una respuesta.";
                    return processAIResponseText(text);
                } catch (error) {
                    if (error.name === 'AbortError') {
                        return { text: "Uff, la respuesta est√° tardando m√°s de lo normal. ¬øPodr√≠as repetir la pregunta?" };
                    }
                    return { text: "Lo siento, tuve un problema t√©cnico. Por favor, intenta de nuevo." };
                }
            }

            function processAIResponseText(text) {
                let isHtml = false;
                let isSponsored = false;
                const linkRegex = /\[\[(.*?)\]\]/g;
                let processedText = text.replace(linkRegex, (match, placeName) => {
                    const foundPlace = findPlaceByName(placeName.trim());
                    if (foundPlace) {
                        isHtml = true;
                        if (foundPlace.nivelAuspicio > 0) isSponsored = true;
                        return `<a class="place-link" data-id="${foundPlace.id}">${placeName}</a>`;
                    }
                    return placeName;
                });
                return { text: processedText, isHtml, isSponsored };
            }

            async function processUserMessage(userMessage) {
                const typingIndicator = showTypingIndicator();
                chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
                const systemPrompt = generateSystemPrompt();
                const aiResponseData = await getAIResponse(chatHistory, systemPrompt);
                const weatherMatch = aiResponseData.text.match(/\[CLIMA:(.*?)\]/);
                if (weatherMatch) {
                    const location = weatherMatch[1].trim();
                    const weatherInfo = await getWeatherData(location);
                    let finalText = weatherInfo.error || await formatWeatherResponse(weatherInfo, 'semana');
                    chatWindow.removeChild(typingIndicator);
                    addMessage({ text: finalText, isHtml: true }, 'ai');
                    chatHistory.push({ role: "model", parts: [{ text: finalText }] });
                    return;
                }
                chatWindow.removeChild(typingIndicator);
                addMessage({ text: aiResponseData.text, isHtml: aiResponseData.isHtml, isSponsored: aiResponseData.isSponsored }, 'ai');
                chatHistory.push({ role: "model", parts: [{ text: aiResponseData.text }] });
            }

            function addMessage(messageData, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message p-4`;
                if (messageData.isHtml) {
                    messageDiv.innerHTML = messageData.text;
                } else {
                    messageDiv.textContent = messageData.text;
                }
                chatWindow.appendChild(messageDiv);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'w-full flex justify-start p-4';
                typingDiv.innerHTML = '<div class="bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-300 p-3 rounded-lg">...</div>';
                chatWindow.appendChild(typingDiv);
                return typingDiv;
            }

            function generateSystemPrompt() {
                return `Eres Andes, un gu√≠a tur√≠stico amigable y profesional de la Comarca Andina.
                Si el usuario pregunta por el clima, el tiempo o la temperatura en una localidad espec√≠fica, tu √öNICA RESPUESTA debe ser el c√≥digo [CLIMA:Nombre de la Localidad].
                Por ejemplo, si preguntan "c√≥mo est√° el tiempo en El Bols√≥n", tu respuesta debe ser exactamente: [CLIMA:El Bols√≥n]. No a√±adas nada m√°s.`;
            }

            function findPlaceByName(name) {
                return placesCache.find(p => p.nombre?.toLowerCase() === name.toLowerCase());
            }

            function listenForNewPlaces() {
                if (!lugaresCollectionRef) return;
                onSnapshot(lugaresCollectionRef, (snapshot) => {
                    placesCache = [];
                    dynamicKnowledgeBase = { restaurantes: {}, alojamiento: {}, actividades: {}, lugaresParaVisitar: {} };
                    snapshot.docs.forEach(doc => {
                        const place = { id: doc.id, ...doc.data() };
                        placesCache.push(place);
                        const tipo = place.tipo;
                        if (dynamicKnowledgeBase[tipo]) {
                            if (!dynamicKnowledgeBase[tipo][place.localidad]) {
                                dynamicKnowledgeBase[tipo][place.localidad] = [];
                            }
                            dynamicKnowledgeBase[tipo][place.localidad].push(place);
                        }
                    });
                    Object.keys(dynamicKnowledgeBase).forEach(tipo => {
                        Object.keys(dynamicKnowledgeBase[tipo]).forEach(localidad => {
                            dynamicKnowledgeBase[tipo][localidad].sort((a, b) => (b.nivelAuspicio || 0) - (a.nivelAuspicio || 0));
                        });
                    });
                    if (!isDataReady) {
                        if (chatInput) chatInput.disabled = false;
                        if (submitButton) submitButton.disabled = false;
                        if (chatInput) chatInput.placeholder = "Preg√∫ntame algo...";
                        isDataReady = true;
                    }
                    updateSuggestions();
                    if (!manageModal.classList.contains('hidden')) {
                        renderManagementList();
                    }
                    if (!mapModal.classList.contains('hidden') && isDataReady) {
                        if (mapInitialized) {
                            updateMapMarkers();
                        }
                    }
                });
            }

            function formatPlaceForAI(place) {
                const estrellas = place.nivelAuspicio > 0 ? '‚≠ê'.repeat(place.nivelAuspicio) + ' ' : '';
                let html = `<h3 class="font-bold text-lg mb-2">${estrellas}${place.nombre}</h3>`;
                html += `<p class="text-sm">${place.descripcion}</p>`;
                if (place.datosClave) {
                    html += `<div class="mt-2 text-xs bg-slate-700 text-gray-100 p-2 rounded"><strong>Datos clave:</strong><br>${place.datosClave.replace(/\n/g, '<br>')}</div>`;
                }
                if (place.direccion || place.telefono) {
                    html += `<div class="mt-2 text-xs">`;
                    if (place.direccion) html += `<strong>Direcci√≥n:</strong> ${place.direccion}<br>`;
                    if (place.telefono) html += `<strong>Tel√©fono:</strong> ${place.telefono}`;
                    html += `</div>`;
                }
                const fotos = [
                    place.imagenURL,
                    place.imagen2URL,
                    place.imagen3URL,
                    place.imagen4URL,
                    place.imagen5URL
                ].filter(url => url && url.trim() !== '');
                if (fotos.length > 0) {
                    html += `<div class="mt-2 grid grid-cols-2 gap-2">`;
                    fotos.forEach(foto => {
                        html += `<img src="${foto}" alt="Foto de ${place.nombre}" class="rounded-lg w-full h-32 object-cover">`;
                    });
                    html += `</div>`;
                }
                html += `<div class="mt-3 flex flex-wrap gap-2">`;
                if (place.imagen360URL) {
                    html += `<button class="view-360-btn text-xs bg-blue-500 text-white py-1 px-3 rounded-full hover:bg-blue-600" data-image="${place.imagen360URL}">Ver en 360¬∞</button>`;
                }
                html += `<button class="rate-place-btn text-xs bg-amber-500 text-white py-1 px-3 rounded-full hover:bg-amber-600" data-id="${place.id}">Ver/Dejar Opiniones</button>`;
                if (place.latitud && place.longitud) {
                    html += `<button class="view-on-map-btn text-xs bg-sky-500 text-white py-1 px-3 rounded-full hover:bg-sky-600" data-id="${place.id}">Ver en Mapa</button>`;
                }
                html += `</div>`;
                return html;
            }

            // === EVENT LISTENERS ===
            document.addEventListener('DOMContentLoaded', function() {
                const startChatBtn = document.getElementById('start-chat-btn');
                if (startChatBtn) {
                    startChatBtn.addEventListener('click', startApp);
                }

                if (chatForm) {
                    chatForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const message = chatInput?.value.trim();
                        if (message) {
                            addMessage({ text: message }, 'user');
                            chatInput.value = '';
                            processUserMessage(message);
                        }
                    });
                }

                // ‚úÖ Listener para el selector de nivel de auspicio
                const nivelAuspicioSelect = document.getElementById('lugar-nivel-auspicio');
                const camposFotosAuspicio = document.getElementById('campos-fotos-auspicio');
                if (nivelAuspicioSelect && camposFotosAuspicio) {
                    nivelAuspicioSelect.addEventListener('change', function() {
                        const nivel = parseInt(this.value);
                        if (nivel > 0) {
                            camposFotosAuspicio.classList.remove('hidden');
                        } else {
                            camposFotosAuspicio.classList.add('hidden');
                        }
                    });
                }
            });
        </script>
    </body>
</html>
            // === FUNCIONES ADICIONALES ===
            function addMessage(messageData, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message p-4`;
                if (messageData.isHtml) {
                    messageDiv.innerHTML = messageData.text;
                } else {
                    messageDiv.textContent = messageData.text;
                }
                chatWindow.appendChild(messageDiv);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'w-full flex justify-start p-4';
                typingDiv.innerHTML = '<div class="bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-300 p-3 rounded-lg">...</div>';
                chatWindow.appendChild(typingDiv);
                return typingDiv;
            }

            function generateSystemPrompt() {
                return `Eres Andes, un gu√≠a tur√≠stico amigable y profesional de la Comarca Andina.
                Si el usuario pregunta por el clima, el tiempo o la temperatura en una localidad espec√≠fica, tu √öNICA RESPUESTA debe ser el c√≥digo [CLIMA:Nombre de la Localidad].
                Por ejemplo, si preguntan "c√≥mo est√° el tiempo en El Bols√≥n", tu respuesta debe ser exactamente: [CLIMA:El Bols√≥n]. No a√±adas nada m√°s.`;
            }

            function findPlaceByName(name) {
                return placesCache.find(p => p.nombre?.toLowerCase() === name.toLowerCase());
            }

            function listenForNewPlaces() {
                if (!lugaresCollectionRef) return;
                onSnapshot(lugaresCollectionRef, (snapshot) => {
                    placesCache = [];
                    dynamicKnowledgeBase = { restaurantes: {}, alojamiento: {}, actividades: {}, lugaresParaVisitar: {} };
                    snapshot.docs.forEach(doc => {
                        const place = { id: doc.id, ...doc.data() };
                        placesCache.push(place);
                        const tipo = place.tipo;
                        if (dynamicKnowledgeBase[tipo]) {
                            if (!dynamicKnowledgeBase[tipo][place.localidad]) {
                                dynamicKnowledgeBase[tipo][place.localidad] = [];
                            }
                            dynamicKnowledgeBase[tipo][place.localidad].push(place);
                        }
                    });
                    Object.keys(dynamicKnowledgeBase).forEach(tipo => {
                        Object.keys(dynamicKnowledgeBase[tipo]).forEach(localidad => {
                            dynamicKnowledgeBase[tipo][localidad].sort((a, b) => (b.nivelAuspicio || 0) - (a.nivelAuspicio || 0));
                        });
                    });
                    if (!isDataReady) {
                        if (chatInput) chatInput.disabled = false;
                        if (submitButton) submitButton.disabled = false;
                        if (chatInput) chatInput.placeholder = "Preg√∫ntame algo...";
                        isDataReady = true;
                    }
                    updateSuggestions();
                    if (!manageModal.classList.contains('hidden')) {
                        renderManagementList();
                    }
                    if (!mapModal.classList.contains('hidden') && isDataReady) {
                        if (mapInitialized) {
                            updateMapMarkers();
                        }
                    }
                });
            }

            function formatPlaceForAI(place) {
                const estrellas = place.nivelAuspicio > 0 ? '‚≠ê'.repeat(place.nivelAuspicio) + ' ' : '';
                let html = `<h3 class="font-bold text-lg mb-2">${estrellas}${place.nombre}</h3>`;
                html += `<p class="text-sm">${place.descripcion}</p>`;
                if (place.datosClave) {
                    html += `<div class="mt-2 text-xs bg-slate-700 text-gray-100 p-2 rounded"><strong>Datos clave:</strong><br>${place.datosClave.replace(/\n/g, '<br>')}</div>`;
                }
                if (place.direccion || place.telefono) {
                    html += `<div class="mt-2 text-xs">`;
                    if (place.direccion) html += `<strong>Direcci√≥n:</strong> ${place.direccion}<br>`;
                    if (place.telefono) html += `<strong>Tel√©fono:</strong> ${place.telefono}`;
                    html += `</div>`;
                }
                const fotos = [
                    place.imagenURL,
                    place.imagen2URL,
                    place.imagen3URL,
                    place.imagen4URL,
                    place.imagen5URL
                ].filter(url => url && url.trim() !== '');
                if (fotos.length > 0) {
                    html += `<div class="mt-2 grid grid-cols-2 gap-2">`;
                    fotos.forEach(foto => {
                        html += `<img src="${foto}" alt="Foto de ${place.nombre}" class="rounded-lg w-full h-32 object-cover">`;
                    });
                    html += `</div>`;
                }
                html += `<div class="mt-3 flex flex-wrap gap-2">`;
                if (place.imagen360URL) {
                    html += `<button class="view-360-btn text-xs bg-blue-500 text-white py-1 px-3 rounded-full hover:bg-blue-600" data-image="${place.imagen360URL}">Ver en 360¬∞</button>`;
                }
                html += `<button class="rate-place-btn text-xs bg-amber-500 text-white py-1 px-3 rounded-full hover:bg-amber-600" data-id="${place.id}">Ver/Dejar Opiniones</button>`;
                if (place.latitud && place.longitud) {
                    html += `<button class="view-on-map-btn text-xs bg-sky-500 text-white py-1 px-3 rounded-full hover:bg-sky-600" data-id="${place.id}">Ver en Mapa</button>`;
                }
                html += `</div>`;
                return html;
            }

            // === EVENT LISTENERS ===
            document.addEventListener('DOMContentLoaded', function() {
                const startChatBtn = document.getElementById('start-chat-btn');
                if (startChatBtn) {
                    startChatBtn.addEventListener('click', startApp);
                }

                if (chatForm) {
                    chatForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const message = chatInput?.value.trim();
                        if (message) {
                            addMessage({ text: message }, 'user');
                            chatInput.value = '';
                            processUserMessage(message);
                        }
                    });
                }

                // ‚úÖ Listener para el selector de nivel de auspicio
                const nivelAuspicioSelect = document.getElementById('lugar-nivel-auspicio');
                const camposFotosAuspicio = document.getElementById('campos-fotos-auspicio');
                if (nivelAuspicioSelect && camposFotosAuspicio) {
                    nivelAuspicioSelect.addEventListener('change', function() {
                        const nivel = parseInt(this.value);
                        if (nivel > 0) {
                            camposFotosAuspicio.classList.remove('hidden');
                        } else {
                            camposFotosAuspicio.classList.add('hidden');
                        }
                    });
                }
            });
        </script>
    </body>
</html>
